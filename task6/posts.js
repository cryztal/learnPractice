var posts = [

    {

        id: '1',

        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'Иванов Иван',

        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',

        likes: ['author', 'someone', 'else'],

        hashTags: ['hash', 'is', 'good']


    },

    {

        id: '2',

        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'Петров Петр',

        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',

        likes: ['author', 'someone', 'else'],

        hashTags: ['hash', 'is', 'good']


    },
    {

        id: '3',

        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'Семенов Семен',

        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',

        likes: ['author', 'someone', 'else'],

        hashTags: ['hash', 'is', 'good']


    },
    {

        id: '4',

        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'Иванов Иван',

        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',

        likes: ['author', 'someone', 'else'],

        hashTags: ['nothing']


    },
    {

        id: '5',

        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'Иванов Иван',

        photoLink: 'somePhoto.jpg',

        likes: ['author', 'someone', 'else'],

        hashTags: ['else']


    },
    {

        id: '6',

        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'Семенов Семен',

        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',

        likes: ['author', 'someone', 'else'],

        hashTags: ['matter']


    },
    {

        id: '7',

        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'Петров Петр',

        photoLink: 'somePhoto.jpg',

        likes: ['author', 'someone', 'else'],

        hashTags: ['hash', 'is', 'good']


    },
    {

        id: '8',

        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'Иванов Иван',

        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',

        likes: ['author', 'someone', 'else'],

        hashTags: ['hash', 'is', 'good']


    },
    {

        id: '9',

        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'Иванов Иван',

        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',

        likes: ['author', 'someone', 'else'],

        hashTags: ['hash', 'is', 'good']


    },
    {

        id: '10',

        description: 'Более 76 тыс. человек во всем мире уже излечились от заболевания, спровоцированного новым коронавирусом, тогда как количество смертей превысило 6,4 тыс.',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'Иванов Иван',

        photoLink: 'somePhoto.jpg',

        likes: ['author', 'someone', 'else'],

        hashTags: ['hash', 'is', 'good']

    },
    {

        id: '11',

        description: 'test',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'test',

        photoLink: 'test.jpg',

        likes: ['test'],

        hashTags: ['testHash']

    },
    {

        id: '12',

        description: 'test',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'test',

        photoLink: 'test.jpg',

        likes: ['test'],

        hashTags: ['testHash']

    },
    {

        id: '13',

        description: 'test',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'test',

        photoLink: 'test.jpg',

        likes: ['test'],

        hashTags: ['testHash']

    },
    {

        id: '14',

        description: 'test',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'test',

        photoLink: 'test.jpg',

        likes: ['test'],

        hashTags: ['testHash']

    },
    {

        id: '15',

        description: 'test',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'test',

        photoLink: 'test.jpg',

        likes: ['test'],

        hashTags: ['testHash']

    },
    {

        id: '16',

        description: 'test',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'test',

        photoLink: 'test.jpg',

        likes: ['test'],

        hashTags: ['testHash']

    },
    {

        id: '17',

        description: 'test',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'test',

        photoLink: 'test.jpg',

        likes: ['test'],

        hashTags: ['testHash']

    },
    {

        id: '18',

        description: 'test',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'test',

        photoLink: 'test.jpg',

        likes: ['test'],

        hashTags: ['testHash']

    },
    {

        id: '19',

        description: 'test',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'test',

        photoLink: 'test.jpg',

        likes: ['test'],

        hashTags: ['testHash']

    },
    {

        id: '20',

        description: 'test',

        createdAt: new Date('2020-05-01T22:00:00'),

        author: 'test',

        photoLink: 'test.jpg',

        likes: ['test'],

        hashTags: ['testHash']

    }


];

(function () {

    let example = {
        id: '21',
        description: 'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.',
        createdAt: new Date('2000-10-10T05:20:00'),
        author: 'author',
        photoLink: 'https://www.pressball.by/images/stories/2020/03/20200310231542.jpg',
        hashTags: ['hello', 'its', 'me'],
        likes: ['author', 'someone', 'else']
    }

    function validatePostId(post) {
        return typeof post.id === 'string';

    }

    function validatePostCreatedAt(post) {
        return typeof post.createdAt === 'object';

    }

    function validateDescription(post) {
        return typeof post.description === 'string';

    }

    function validateAuthor(post) {
        return typeof post.author === 'string';

    }

    function validateLikes(post) {
        return typeof post.likes === 'object';

    }

    function validateHashTags(post) {
        if (typeof post.hashTags !== 'object') {
            //console.log("Invalid field hashTags!");
            return false;
        } else {
            for (let i of post.hashTags) {
                if (typeof i !== 'string') {
                    return false;
                }
            }
        }
        return true;
    }

    function validatePhotoLink(post) {
        return typeof post.photoLink === 'string';
    }

    function validatePost(post) {
        return (validatePostId(post) && validatePostCreatedAt(post) && validateDescription(post) && validateAuthor(post) && validatePhotoLink(post));
    }

    function getPost(id) {
        let post = posts.find((item) => item.id === id);
        if (!post) {
            console.log("post not finded");
            return false;
        }
        return post;
    }

    function addPost(post) {
        if (!validatePost(post)) {
            console.log("post is not valid");
            return false;
        }
        let check = getPost(post.id);
        if (!check) {
            console.log('id is not original');
            return false;
        }
        posts.push(post);
        return true;
    }

    function editPost(id, post) {
        let originalPost = getPost(id);
        let flag = false;
        if (!originalPost) {
            return false;
        }
        if (validateDescription(post)) {
            originalPost.description = post.description;
            flag = true;
        }

        if (validatePhotoLink(post)) {
            originalPost.photoLink = post.photoLink;
            flag = true;
        }
        if (validateHashTags(post)) {
            originalPost.hashTags = post.hashTags;
            flag = true;
        }

        if (validateLikes(post)) {
            originalPost.likes = post.likes;
            flag = true;
        }
        return flag;
    }

    function removePost(id) {
        let index = posts.findIndex((post) => post.id === id);
        if (index !== -1) {
            posts.splice(index, 1);
            return true;
        }
        //console.log("post is not finded");
        return false;
    }

    function getPosts(skip, top, filterConfig) {
        let resultPosts = posts;
        resultPosts = resultPosts.slice(skip, skip + top);

        resultPosts.sort(function (a, b) {
            return b.createdAt - a.createdAt;
        });
        if (!filterConfig) {
            return resultPosts;
        }

        //console.log(validateAuthor(filterConfig));
        //console.log(validatePostCreatedAt(filterConfig));
        //console.log(validateHashTags(filterConfig));
        if (validateAuthor(filterConfig)) {
            resultPosts = posts.filter(item => item.author === filterConfig.author);
        }
        if (validatePostCreatedAt(filterConfig)) {
            resultPosts = resultPosts.filter(item => item.createdAt === filterConfig.createdAt);
        }
        if (validateHashTags(filterConfig)) {
            resultPosts = resultPosts.filter(function (item) {
                let flag = true;
                for (let i of filterConfig.hashTags) {
                    if (!item.hashTags.includes(i)) {
                        flag = false;
                        break;
                    }
                }
                return flag;
            });
        }
        return resultPosts;
    }

    console.log("check post validation\nvalid:");
    console.log(validatePost(posts[0]));
    console.log("invalid:");
    console.log(validatePost(1));
    console.log("-----------------------------------------------------------------------------------------------------------------------------------------");

    console.log('checking getPost');
    console.log("valid:")
    console.log(getPost('1'));
    console.log("invalid:");
    console.log(getPost('0'));
    console.log("-----------------------------------------------------------------------------------------------------------------------------------------");

    console.log("checking adding post");
    console.log("valid:")
    console.log(addPost(example));
    console.log("invalid:")
    console.log(addPost('Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim ven'));
    console.log("-----------------------------------------------------------------------------------------------------------------------------------------");

    console.log("checking editing post");
    console.log("valid:");
    console.log(getPost('21'));
    console.log(editPost('21', {description: 'hello'}));
    console.log(getPost('21'));
    console.log("invalid:")
    console.log(editPost("1", {author: "Mr. Snow"}));
    console.log("-----------------------------------------------------------------------------------------------------------------------------------------");

    console.log("checking removing post");
    console.log("valid:");
    console.log(removePost('20'));
    console.log("invalid:")
    console.log(removePost('21'));
    console.log("-----------------------------------------------------------------------------------------------------------------------------------------");

    console.log("checking getPosts");
    console.log("valid:");
    console.log(getPosts(0, 10, {author: 'Иванов Иван'}));
    console.log('second');
    console.log(getPosts(3, 10, {hashTags: ['good']}));
    console.log('third');
    console.log(getPosts(5, 10));
    console.log("invalid:")
    console.log(getPosts(0, 10, {author: 'Васильев Василий'}));
    console.log("-----------------------------------------------------------------------------------------------------------------------------------------");
}())
